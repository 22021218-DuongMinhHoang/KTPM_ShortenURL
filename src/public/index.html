<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CS1 - URL Shortener</title>
  <style>
    :root {
      --bg: #f6f8fa;
      --card: #ffffff;
      --accent: #2563eb;
      --muted: #6b7280;
    }
    body {
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, var(--bg), #eef2ff);
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }
    .card {
      background: var(--card);
      width: 100%;
      max-width: 720px;
      padding: 28px;
      border-radius: 12px;
      box-shadow: 0 8px 30px rgba(16,24,40,0.08);
    }
    h1 { margin: 0 0 8px 0; font-size: 20px; }
    p.lead { margin: 0 0 18px 0; color: var(--muted); }

    .row {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
    }
    input[type="url"] {
      flex: 1;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #e6e9ee;
      font-size: 14px;
    }
    button {
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }
    button:disabled { opacity: 0.6; cursor: default; }

    .result {
      margin-top: 16px;
      padding: 12px;
      border-radius: 8px;
      background: #f8fafc;
      border: 1px dashed #e6eefc;
      color: #0f172a;
      word-break: break-all;
    }

    .small {
      font-size: 13px;
      color: var(--muted);
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>CS1 — URL Shortener</h1>
    <p class="lead">Nhập URL cần rút gọn, nhấn Confirm để tạo ID ngắn.</p>

    <div class="row">
      <input id="urlInput" type="url" placeholder="https://example.com/long-url" />
      <button id="confirmBtn">Confirm</button>
    </div>

    <div id="feedback" class="small">Bạn có thể nhập cả đường dẫn có http(s) hoặc domain.</div>

    <div id="result" class="result" style="display:none;">
      <div><strong>ID:</strong> <span id="shortId"></span></div>
      <div style="margin-top:8px;"><strong>Short URL:</strong> <a id="shortLink" href="#" target="_blank"></a></div>
    </div>
  </div>

  <script>
    const urlInput = document.getElementById('urlInput');
    const confirmBtn = document.getElementById('confirmBtn');
    const feedback = document.getElementById('feedback');
    const resultBox = document.getElementById('result');
    const shortIdEl = document.getElementById('shortId');
    const shortLinkEl = document.getElementById('shortLink');

    // Adjust this base if your server uses different host/port in prod
    const baseHost = window.location.origin; // same origin as server

    function setLoading(isLoading) {
      confirmBtn.disabled = isLoading;
      confirmBtn.textContent = isLoading ? 'Processing...' : 'Confirm';
    }

    confirmBtn.addEventListener('click', async () => {
      const url = urlInput.value.trim();
      if (!url) {
        feedback.textContent = 'Vui lòng nhập một URL hợp lệ.';
        return;
      }
      feedback.textContent = 'Đang gửi...';
      setLoading(true);
      resultBox.style.display = 'none';

      try {
        // Your server expects POST /create?url=...
        // Using encodeURIComponent to be safe
        const resp = await fetch(`/create?url=${encodeURIComponent(url)}`, {
          method: 'POST'
        });

        if (!resp.ok) {
          const text = await resp.text();
          throw new Error(text || `Server returned ${resp.status}`);
        }

        const data = await resp.text(); // server returns newID as raw text in current code
        const newID = (data || '').trim();

        if (!newID) {
          feedback.textContent = 'Server trả về kết quả rỗng.';
        } else {
          shortIdEl.textContent = newID;
          const shortUrl = `${baseHost}/short/${encodeURIComponent(newID)}`;
          shortLinkEl.textContent = shortUrl;
          shortLinkEl.href = shortUrl;
          resultBox.style.display = 'block';
          feedback.textContent = 'Tạo thành công!';
        }
      } catch (err) {
        feedback.textContent = 'Lỗi: ' + (err.message || err);
      } finally {
        setLoading(false);
      }
    });

    // optional: allow Enter key
    urlInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') confirmBtn.click();
    });
  </script>
</body>
</html>
